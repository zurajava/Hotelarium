<div class="box-header">
    <div class="reservation_filter">
        <kendo-dropdownlist [data]="userBranch" [textField]="'name'" [valueField]="'id'" [value]="brSelectedValue" [valuePrimitive]="true"
            (valueChange)="brValueChange($event)">
        </kendo-dropdownlist>
        <kendo-datepicker [(value)]="dateFrom" id="dateFrom" name="ndateFrom"></kendo-datepicker>
        <kendo-datepicker [(value)]="dateTo" id="dateTo" name="ndateTo"></kendo-datepicker>
        <button (click)="filterRezervation()" class="reservation_btn"><i class="fa fa-search" style="font-size:14px"></i>Filter</button>
    </div>
</div>
<!-- Register Reservation -->
<div *ngIf="showReservation" class="reservation-container">
    <form class="k-form-inline">
        <fieldset>
            <legend>Personal Info</legend>
            <div class="person_registration_table">
                <table style="width:100%; text-align: left;">
                    <tr>
                        <td><span>Personal Number</span></td>
                        <td>
                            <input class="k-textbox" ngui-auto-complete [source]="persons" (valueChanged)="valueChanged($event)" placeholder="Personal #"
                                name="n_personal_no" [(ngModel)]="reservationInfo.person.personal_no" [list-formatter]="autoCompliteListFormatter"
                            />
                        </td>
                        <td><span>First Name</span></td>
                        <td><input class="k-textbox" placeholder="First Name" name="first_name" [(ngModel)]="reservationInfo.person.first_name"
                            /></td>
                        <td><span>Last Name</span></td>
                        <td><input class="k-textbox" placeholder="Last Name" name="last_name" [(ngModel)]="reservationInfo.person.last_name"
                            /></td>
                        <td><span>Email</span></td>
                        <td><input class="k-textbox" placeholder="Email" name="email" [(ngModel)]="reservationInfo.person.email"
                            /></td>
                    </tr>
                    <tr>
                        <td><span>Phone</span></td>
                        <td><input class="k-textbox" placeholder="Phone" name="phone" [(ngModel)]="reservationInfo.person.phone"
                            /></td>
                        <td><span>Address</span></td>
                        <td><input class="k-textbox" placeholder="Address" name="address" [(ngModel)]="reservationInfo.person.address"
                            /></td>
                        <td><span>Gender</span></td>
                        <td>
                            <kendo-combobox name="gender" [data]="genders" [textField]="'text'" [valueField]="'text'" [valuePrimitive]="true" [(ngModel)]="reservationInfo.person.gender">
                            </kendo-combobox>
                        </td>
                        <td><span>Birth Date</span></td>
                        <td>
                            <kendo-datepicker id="birthdate" name="birthdate" [(ngModel)]="reservationInfo.person.birthdate"></kendo-datepicker>
                        </td>
                    </tr>
                </table>
            </div>
        </fieldset>
        <fieldset>
            <legend>Reservation Info</legend>
            <div class="add_reservation_btn">
                <button class="reservation_btn" (click)="addReservation()"><i class="fa fa-plus" style="font-size:14px"></i>Reservation</button>
            </div>
            <table class="reservation_table">
                <tr>
                    <div class="person_div_tr">
                        <th>Category</th>
                        <th>Room No</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Adult</th>
                        <th>Child</th>
                        <th>Additional Bed</th>
                        <th>Extra Person</th>
                        <th>Status</th>
                        <th>Command</th>
                    </div>
                </tr>

                <tr *ngFor="let res of reservationInfo.reservation.reservationDetail; let i = index">
                    <div class="person_div_tr">
                        <td width="50">
                            <kendo-combobox style="width:140px" name="category" [data]="category" [textField]="'name'" [valueField]="'id'" [valuePrimitive]="true"
                                [(value)]="res.category_id" (valueChange)="categoryValueChange($event)">
                            </kendo-combobox>
                        </td>
                        <td>
                            <kendo-combobox style="width:120px" name="room" [data]="room" [textField]="'room_no'" [valueField]="'id'" [valuePrimitive]="true"
                                [(value)]="res.room_id">
                            </kendo-combobox>
                        </td>
                        <td>
                            <kendo-datepicker style="width:120px" [(value)]="res.start_date" (valueChange)="handleChangeStartDate($event,i)" id="start_date"
                                name="nstart_date"></kendo-datepicker>
                        </td>
                        <td>
                            <kendo-datepicker style="width:120px" [(value)]="res.end_date" (valueChange)="handleChangeEndDate($event,i)" id="end_date"
                                name="nend_date"></kendo-datepicker>
                        </td>


                        <td>
                            <kendo-numerictextbox style="width:80px" id="ad" [(value)]="res.adult" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>
                        </td>
                        <td>
                            <kendo-numerictextbox style="width:80px" id="ada" [(value)]="res.child" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>

                        </td>
                        <td>
                            <kendo-numerictextbox style="width:80px" id="ads" [(value)]="res.additional_bed" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>

                        </td>
                        <td>
                            <kendo-numerictextbox style="width:80px" id="ads" [(value)]="res.extra_person" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>

                        </td>

                        <td>
                            <kendo-combobox style="width: 130px" name="reservationStatus" [data]="reservationStatus" [textField]="'text'" [valueField]="'value'"
                                [valuePrimitive]="true" [(value)]="res.status_id">
                            </kendo-combobox>
                        </td>
                        <td><button class="reservation_btn" (click)="addService(res)"><i class="fa fa-gear" style="font-size:14px"></i>Service</button>
                            <button class="reservation_btn" (click)="addPerson(res)"><i class="fa fa-user-plus" style="font-size:14px"></i>Person</button>
                            <button class="reservation_btn" (click)="removeReservation(res)"><i class="fa fa-close" style="font-size:14px;"></i>Remove</button>
                        </td>
                        <div class="person_div" *ngIf="res.expandPerson">
                            <div class="add_service_person_btn">
                                <button class="reservation_btn" (click)="addPersonToReservationPerson(res)"><i class="fa fa-plus" style="font-size:14px"></i>Person</button>
                            </div>
                            <table class="person_table_class">
                                <tr>
                                    <th>Personal No</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Command</th>
                                </tr>
                                <tr *ngFor="let person of res.reservationPerson; let i = index">
                                    <td>
                                        <input kendoTextBox id="n_person_id" name="n_person_id_name" [value]="person.person_id" (input)="person.person_id = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox id="n_first_name" name="n_first_name_name" [value]="person.first_name" (input)="person.first_name = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox id="n_last_name" name="n_last_name_name" [value]="person.last_name" (input)="person.last_name = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <button class="reservation_btn" (click)="removeReservationPerson(res,person)"><i class="fa fa-close" style="font-size:14px;"></i>Remove</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="service_div" *ngIf="res.expandService">
                            <div class="add_service_person_btn">
                                <button class="reservation_btn" (click)="addServiceToReservationService(res)"><i class="fa fa-plus" style="font-size:14px"></i>Service</button>
                            </div>
                            <table class="service_table_class">
                                <tr>
                                    <th>Service Id</th>
                                    <th>Frequency</th>
                                    <th>Additional Comment</th>
                                    <th>Service Name</th>
                                    <th>Command</th>
                                </tr>
                                <tr *ngFor="let service of res.reservationService; let i = index">

                                    <td>
                                        <input kendoTextBox id="id_n_service_id" name="n_service_id_name" [value]="service.service_id" (input)="service.service_id = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox id="id_n_frequency" name="n_frequency_name" [value]="service.frequency" (input)="service.frequency = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox id="id_n_additional_comment" name="n_additional_comment_name" [value]="service.additional_comment" (input)="service.additional_comment = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox id="id_n_service_name" name="n_service_name_name" [value]="service.service_name" (input)="service.service_name = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <button class="reservation_btn" (click)="removeReservationService(res,service)"><i class="fa fa-close" style="font-size:14px;"></i>Remove</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>operations</legend>
            <div>
                <button class="reservation_btn" (click)="registerReservation()">Register</button>
            </div>
        </fieldset>
    </form>
</div>
<!-- Edit Reservation -->
<div *ngIf="showReservationPayment && reservationInfoEdit" class="reservation-container">
    <form class="k-form-inline">
        <fieldset>
            <legend>Personal Info E</legend>
            <div class="person_registration_table">
                <table style="width:100%; text-align: left;">
                    <tr>
                        <td><span>Personal Number</span></td>
                        <td>
                            <input class="k-textbox" ngui-auto-complete [source]="persons" (valueChanged)="valueChangedEdit($event)" placeholder="Personal #"
                                name="n_personal_no" [(ngModel)]="reservationInfoEdit.person.personal_no" [list-formatter]="autoCompliteListFormatter"
                            />
                        </td>
                        <td><span>First Name</span></td>
                        <td><input class="k-textbox" placeholder="First Name" name="first_name" [(ngModel)]="reservationInfoEdit.person.first_name"
                            /></td>
                        <td><span>Last Name</span></td>
                        <td><input class="k-textbox" placeholder="Last Name" name="last_name" [(ngModel)]="reservationInfoEdit.person.last_name"
                            /></td>
                        <td><span>Email</span></td>
                        <td><input class="k-textbox" placeholder="Email" name="email" [(ngModel)]="reservationInfoEdit.person.email"
                            /></td>
                    </tr>
                    <tr>
                        <td><span>Phone</span></td>
                        <td><input class="k-textbox" placeholder="Phone" name="phone" [(ngModel)]="reservationInfoEdit.person.phone"
                            /></td>
                        <td><span>Address</span></td>
                        <td><input class="k-textbox" placeholder="Address" name="address" [(ngModel)]="reservationInfoEdit.person.address"
                            /></td>
                        <td><span>Gender</span></td>
                        <td>
                            <kendo-combobox name="gender" [data]="genders" [textField]="'text'" [valueField]="'text'" [valuePrimitive]="true" [(ngModel)]="reservationInfoEdit.person.gender">
                            </kendo-combobox>
                        </td>
                        <td><span>Birth Date</span></td>
                        <td>
                            <kendo-datepicker id="birthdate" name="birthdate" [(ngModel)]="reservationInfoEdit.person.birthdate"></kendo-datepicker>
                        </td>
                    </tr>
                </table>
            </div>
        </fieldset>
        <fieldset>
            <legend>Reservation Info E</legend>
            <div class="add_reservation_btn">
                <button class="reservation_btn" (click)="addReservationToExisting()"><i class="fa fa-plus" style="font-size:14px"></i>Reservation</button>
            </div>
            <table class="reservation_table">
                <div class="person_div_tr">
                    <tr>
                        <th>Category</th>
                        <th>Room No</th>
                        <th>Start Date</th>
                        <th>End Date</th>
                        <th>Adult</th>
                        <th>Child</th>
                        <th>Additional Bed</th>
                        <th>Extra Person</th>
                        <th>Status</th>
                        <th>Command</th>
                    </tr>
                </div>
                <tr *ngFor="let res of reservationInfoEdit.reservation.reservationDetail; let i = index">

                    <div class="person_div_tr">
                        <td>
                            <kendo-combobox style="width:130px" name="category" [data]="category" [textField]="'name'" [valueField]="'id'" [valuePrimitive]="true"
                                [(value)]="res.category_id">
                            </kendo-combobox>
                        </td>
                        <td>
                            <kendo-combobox style="width:110px" name="room" [data]="room" [textField]="'room_no'" [valueField]="'id'" [valuePrimitive]="true"
                                [(value)]="res.room_id">
                            </kendo-combobox>
                        </td>
                        <td>
                            <kendo-datepicker style="width:120px" [(value)]="res.start_date" (valueChange)="handleChangeStartDateEdit($event,i)" id="start_date"
                                name="nstart_date"></kendo-datepicker>
                        </td>
                        <td>
                            <kendo-datepicker style="width:120px" [(value)]="res.end_date" (valueChange)="handleChangeEndDateEdit($event,i)" id="end_date"
                                name="nend_date"></kendo-datepicker>
                        </td>
                        <td>
                            <kendo-numerictextbox style="width:80px" id="ad" [(value)]="res.adult" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>
                        </td>
                        <td>
                            <kendo-numerictextbox style="width:80px" id="ada" [(value)]="res.child" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>

                        </td>
                        <td>
                            <kendo-numerictextbox style="width:80px" id="ads" [(value)]="res.additional_bed" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>

                        </td>
                        <td>
                            <kendo-numerictextbox style="width:70px" id="ads" [(value)]="res.extra_person" [min]="0" [max]="100" [autoCorrect]="true">
                            </kendo-numerictextbox>

                        </td>
                        <td>
                            <kendo-combobox style="width:130px" name="reservationStatus" [data]="reservationStatus" [textField]="'text'" [valueField]="'value'"
                                [valuePrimitive]="true" [(value)]="res.status_id">
                            </kendo-combobox>
                        </td>
                        <td>
                            <button class="reservation_btn" (click)="updateReservation(res)">Save</button>
                            <button class="reservation_btn" (click)="addServiceEdit(res)"><i class="fa fa-gear" style="font-size:14px"></i>Service</button>
                            <button class="reservation_btn" (click)="addPersonEdit(res)"><i class="fa fa-user-plus" style="font-size:14px"></i>Person</button>
                            <button class="reservation_btn" (click)="removeReservationExisting(res)"><i class="fa fa-close" style="font-size:14px;"></i>Remove</button>
                        </td>
                        <div class="person_div" *ngIf="res.expandPerson">
                            <div class="add_service_person_btn">
                                <button class="reservation_btn" (click)="addPersonToReservationPersonExisting(res)"><i class="fa fa-plus" style="font-size:14px"></i>Person</button>
                            </div>
                            <table class="person_table_class">
                                <tr>
                                    <th>Personal No</th>
                                    <th>First Name</th>
                                    <th>Last Name</th>
                                    <th>Command</th>
                                </tr>
                                <tr *ngFor="let person of res.reservationPerson; let i = index">
                                    <td width="50">
                                        <input kendoTextBox style="width:140px" id="id_person_id" [value]="person.person_id" (input)="person.person_id = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox style="width:140px" id="id_first_name" [value]="person.first_name" (input)="person.first_name = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox style="width:140px" id="id_last_name" [value]="person.last_name" (input)="person.last_name = $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <button class="reservation_btn" (click)="removeReservationPersonExisting(res,person)"><i class="fa fa-close" style="font-size:14px;"></i>Remove</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="service_div" *ngIf="res.expandService">
                            <div class="add_service_person_btn">
                                <button class="reservation_btn" (click)="addServiceToReservationServiceExisting(res)"><i class="fa fa-plus" style="font-size:14px"></i>Service</button>
                            </div>
                            <table class="service_table_class">
                                <tr>
                                    <th>Service Id</th>
                                    <th>Frequency</th>
                                    <th>Additional Comment</th>
                                    <th>Service Name</th>
                                    <th>Command</th>
                                </tr>
                                <tr *ngFor="let service of res.reservationService; let i = index">
                                    <td width="50">
                                        <input kendoTextBox style="width:140px" id="id_service_id" [value]="service.service_id" (input)="service.service_id= $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox style="width:140px" id="id_service_id" [value]="service.frequency" (input)="service.frequency= $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox style="width:140px" id="id_service_id" [value]="service.additional_comment" (input)="service.additional_comment= $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <input kendoTextBox style="width:140px" id="id_service_id" [value]="service.service_name" (input)="service.service_name= $event.target.value"
                                        />
                                    </td>
                                    <td>
                                        <button class="reservation_btn" (click)="removeReservationServiceExisting(res,service)"><i class="fa fa-close" style="font-size:14px;"></i>Remove</button>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </tr>
            </table>
        </fieldset>
        <fieldset>
            <legend>operations e</legend>
            <div>
                <button class="reservation_btn" (click)="updateAllReservation()">Update All</button>
                <button class="reservation_btn" (click)="paymentReservationAll()">Payment All</button>
            </div>
        </fieldset>
    </form>
</div>

<div class="timeline-container">
    <table class="time_table_class">
        <thead>
            <tr>
                <th>ოთახები</th>
                <th *ngFor="let dateSingle of dateRange">
                    <div class="date-dt-bold">{{dateSingle | date:'dd'}}</div>
                    <div class="date-dt-lite">{{dateSingle | date:'MMM'|uppercase}}</div>
                    <div class="date-dt-lite">{{dateSingle | date:'EEE'|uppercase}}</div>
                </th>
            </tr>
        </thead>

        <tbody *ngFor="let caterory of data">
            <tr>
                <td [colSpan]="segment">{{ caterory.name }}</td>
            </tr>
            <tr *ngFor="let room of caterory.rooms">
                <td>{{room.room_no}}</td>
                <td [colSpan]="schedule?.dayDiff" (click)="openReservationForm(schedule.isAvailable,room.room_no,schedule.startDate,schedule.endDate,schedule.currentDate,schedule.status,caterory.name,schedule.reservation_id)"
                    [className]="schedule.status" *ngFor="let schedule of room.reservations">
                    {{schedule?.firstName}}
                </td>
            </tr>
        </tbody>
    </table>
</div>